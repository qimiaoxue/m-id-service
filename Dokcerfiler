FROM golang:1.18 as base

FROM base as built

WORKDIR /opt/app/api
COPY . .

RUN go get -d -v ./...
RUN go build -o /usr/bin/m-id-server ./app/*
# RUN go build -o /tmp/api-server ./app/*

# FROM busybox
# COPY --from=built /tmp/api-server /usr/bin/api-server

EXPOSE 8080 8888 9999 5555

CMD ["m-id-server"]